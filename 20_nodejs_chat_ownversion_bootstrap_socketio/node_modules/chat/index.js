
var users = {};

function eHandler(socket) {
		socket.on("connection",function(client) {
				client.on("join",function(name) {
						name=name.replace(/[^\w\d]/g,"");
						if(name!="") {
										users[client.id]=name;
										client.emit("update","you have connected to the chatroom");
										socket.sockets.emit("update",name+" has joined the server");
										socket.sockets.emit("update-users",users);
									}
						
					});
					
				client.on("send",function(message) {
						message = message.replace(/[^\d\w\sщ,!ръ=()-\.?;'\n\r]/g,""); // sanitize msg 
						socket.sockets.emit("update",users[client.id]+" : "+message);
					});
					
				client.on("leave",function() {
						socket.sockets.emit("update",users[client.id]+" has left the channel");
						delete users[client.id];
						socket.sockets.emit("update-users",users);
					});
					
				client.on("disconnect",function() { // hit F5 ( page refresh ).
						socket.sockets.emit("update",users[client.id]+" has left the channel");
						delete users[client.id];
						socket.sockets.emit("update-users",users);
					});
					
			});
			
		
	}
	
exports.eHandler = eHandler;